<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no" />
<title>NHCE & NHCM Portal</title>
<link rel="manifest" href="manifest.json">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
<style>
html, body {
    margin: 0; padding: 0;
    overflow: hidden;
    height: 100vh; width: 100vw;
    font-family: 'Segoe UI', Arial, sans-serif;
    background-color: #f8f9fa;
    position: relative;
    touch-action: none; 
}

#transitionOverlay {
    position: fixed;
    top: 0; left: 0;
    width: 100%; height: 100%;
    background-color: #ffffff;
    z-index: 200;
    pointer-events: none;
    opacity: 0;
}

/* Static Background Doodles */
.doodle-bg {
    position: fixed;
    top: 0; left: 0;
    width: 100vw; height: 100vh;
    z-index: 0;
    pointer-events: none;
    display: grid;
    grid-template-columns: repeat(auto-fill, minmax(clamp(60px, 8vw, 120px), 1fr));
    grid-template-rows: repeat(auto-fill, minmax(clamp(60px, 8vw, 120px), 1fr));
    gap: 5px; opacity: 0.05; 
    box-sizing: border-box;
}

.doodle-bg i {
    font-size: clamp(1rem, 2vw, 2rem);
    color: #221d5c;
    display: flex; justify-content: center; align-items: center;
    transform: rotate(-15deg);
}

canvas { 
    display: block; position: fixed;
    top: 0; left: 0;
    width: 100%; height: 100%;
    z-index: 1;
    pointer-events: none;
}

.split-view {
    position: relative;
    display: flex;
    width: 100vw;
    height: 100vh;
    z-index: 101;
    pointer-events: none; /* Allows click to pass to zones */
}

.portal-side {
    flex: 1;
    display: flex;
    justify-content: center;
    align-items: center;
    pointer-events: none;
}

/* EXACT CLICKABLE AREA */
.click-zone {
    display: flex;
    flex-direction: column;
    align-items: center;
    cursor: pointer;
    pointer-events: auto; /* Re-enable for the logo only */
    -webkit-tap-highlight-color: transparent;
    padding: 40px;
    border-radius: 50%;
    z-index: 10;
}

.logo-container {
    position: relative;
    width: clamp(180px, 20vw, 450px); 
    height: clamp(180px, 20vw, 450px);
    display: flex; justify-content: center; align-items: center;
    animation: pulse 1.5s infinite alternate;
}

.logo-container img {
    width: 85%; height: 85%;
    object-fit: contain;
}

.tap-text {
    margin-top: clamp(15px, 2vh, 30px);
    font-size: clamp(22px, 3vw, 55px);
    font-weight: 900;
    color: #221d5c; 
    text-shadow: 0 0 20px rgba(255,255,255,0.8);
}

.ripple {
    position: absolute;
    top: 50%; left: 50%;
    width: 100%; height: 100%;
    border-radius: 50%;
    border: 1.5px solid rgba(34, 29, 92, 0.1); 
    pointer-events: none;
    transform: translate(-50%, -50%) scale(1);
    opacity: 0;
    animation: rippleAnim 3.5s infinite ease-out;
}

@keyframes rippleAnim {
    0% { transform: translate(-50%, -50%) scale(1); opacity: 0.6; }
    100% { transform: translate(-50%, -50%) scale(2.2); opacity: 0; }
}

.r2 { animation-delay: 0.5s; }
.r3 { animation-delay: 1.0s; }

@keyframes pulse {
    0% { transform: scale(1); }
    100% { transform: scale(1.04); }
}
</style>
</head>
<body>

<div id="transitionOverlay"></div>
<div id="doodleContainer" class="doodle-bg"></div>

<div class="split-view">
    <div class="portal-side">
        <div class="click-zone" onclick="startTransition(event, 'index-2.html')">
            <div class="logo-container">
                <img src="images/L1.png" alt="NHCE Logo" />
                <div class="ripple r1"></div>
                <div class="ripple r2"></div>
                <div class="ripple r3"></div>
            </div>
            <div class="tap-text">DISCOVER →</div>
        </div>
    </div>

    <div class="portal-side">
        <div class="click-zone" onclick="startTransition(event, 'index-3.html')">
            <div class="logo-container">
                <img src="images/L2.png" alt="NHCM Logo" />
                <div class="ripple r1"></div>
                <div class="ripple r2"></div>
                <div class="ripple r3"></div>
            </div>
            <div class="tap-text">DISCOVER →</div>
        </div>
    </div>
</div>

<script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r128/three.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/gsap/3.12.2/gsap.min.js"></script>

<script>
// Performance & Doodle Setup
function fillStaticDoodles() {
    const container = document.getElementById('doodleContainer');
    container.innerHTML = '';
    const icons = ['fa-book-open', 'fa-user-graduate', 'fa-microchip', 'fa-pen-fancy'];
    for(let i=0; i < 100; i++) {
        const icon = document.createElement('i');
        icon.className = `fa-solid ${icons[Math.floor(Math.random() * icons.length)]}`;
        container.appendChild(icon);
    }
}
fillStaticDoodles();

const scene = new THREE.Scene();
const camera = new THREE.PerspectiveCamera(75, window.innerWidth / window.innerHeight, 0.1, 1000);
camera.position.z = 5;

const renderer = new THREE.WebGLRenderer({ antialias: true, alpha: true });
renderer.setSize(window.innerWidth, window.innerHeight);
renderer.setPixelRatio(Math.min(window.devicePixelRatio, 2));
document.body.appendChild(renderer.domElement);

// --- KINETIC SYSTEM: WATER BUBBLES & EDUCATION DOODLES ---
const kineticElements = [];
const group = new THREE.Group();
scene.add(group);

const loader = new THREE.FontLoader(); 
// We use simple geometric placeholders for doodles to keep it fast/lag-free
function createKineticItems() {
    const colors = ['#e74c3c', '#3498db', '#ffffff']; // Red, Blue, White (Subtle)
    const count = 50;

    for(let i=0; i<count; i++) {
        const color = colors[Math.floor(Math.random() * colors.length)];
        const isDoodle = Math.random() > 0.4;
        
        let geo;
        if(isDoodle) {
            // Placeholder for education shapes (Triangles/Squares acting as kinetic symbols)
            geo = Math.random() > 0.5 ? new THREE.BoxGeometry(0.15, 0.15, 0.15) : new THREE.ConeGeometry(0.1, 0.2, 4);
        } else {
            geo = new THREE.SphereGeometry(0.1, 12, 12);
        }

        const mat = new THREE.MeshBasicMaterial({ 
            color: color, 
            transparent: true, 
            opacity: 0.2
        });

        const mesh = new THREE.Mesh(geo, mat);
        resetElement(mesh);
        mesh.position.y = (Math.random() * 14) - 7;
        
        kineticElements.push({
            mesh: mesh,
            speed: 0.005 + Math.random() * 0.015,
            rotation: Math.random() * 0.02,
            wobble: Math.random() * 2
        });
        group.add(mesh);
    }
}

function resetElement(mesh) {
    mesh.position.x = (Math.random() - 0.5) * 14;
    mesh.position.y = -7;
    mesh.position.z = Math.random() * 2;
    mesh.scale.setScalar(0.5 + Math.random() * 1.5);
}
createKineticItems();

// Wave Shader Background
const waveGeo = new THREE.PlaneGeometry(30, 30, 32, 32);
const waveMat = new THREE.ShaderMaterial({
    uniforms: { uTime: { value: 0 } },
    vertexShader: `
        uniform float uTime;
        void main() {
            vec3 p = position;
            p.z += sin(p.x * 0.5 + uTime) * 0.1;
            gl_Position = projectionMatrix * modelViewMatrix * vec4(p, 1.0);
        }
    `,
    fragmentShader: `
        void main() { gl_FragColor = vec4(0.13, 0.11, 0.36, 0.04); }
    `,
    transparent: true
});
const wave = new THREE.Mesh(waveGeo, waveMat);
wave.position.z = -2;
scene.add(wave);

let animId;
function animate(t) {
    animId = requestAnimationFrame(animate);
    const time = t * 0.001;
    waveMat.uniforms.uTime.value = time;

    kineticElements.forEach(el => {
        el.mesh.position.y += el.speed;
        el.mesh.rotation.x += el.rotation;
        el.mesh.rotation.y += el.rotation;
        el.mesh.position.x += Math.sin(time + el.wobble) * 0.005;
        if(el.mesh.position.y > 7) resetElement(el.mesh);
    });

    renderer.render(scene, camera);
}
animate();

// FIXED TRANSITION LOGIC
let isTransitioning = false;
function startTransition(event, url) {
    if (isTransitioning) return;
    isTransitioning = true;

    const clicked = event.currentTarget;
    const allZones = document.querySelectorAll('.click-zone');

    const tl = gsap.timeline({
        onComplete: () => { 
            cancelAnimationFrame(animId);
            renderer.dispose();
            window.location.href = url; 
        }
    });

    // 1. Only the clicked logo explodes
    tl.to(clicked, { 
        scale: 10, 
        opacity: 0, 
        duration: 1.1, 
        ease: "expo.in" 
    });

    // 2. Everything else fades
    allZones.forEach(z => {
        if(z !== clicked) tl.to(z, { opacity: 0, scale: 0.5, duration: 0.4 }, 0);
    });

    // 3. Kinetic items fly away
    kineticElements.forEach(el => {
        tl.to(el.mesh.position, { 
            y: "+=12", 
            duration: 1.1, 
            ease: "power2.in" 
        }, 0);
    });

    tl.to("#transitionOverlay", { opacity: 1, duration: 0.6 }, "-=0.4");
}

window.addEventListener('resize', () => {
    camera.aspect = window.innerWidth / window.innerHeight;
    camera.updateProjectionMatrix();
    renderer.setSize(window.innerWidth, window.innerHeight);
});
</script>
</body>
</html>